<html>
    <head>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> MAGNIFIG SPACE  </title>
        <link rel="shortcut icon" href="favicon.ico" >
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
         <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">

          <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script>

            var valido = false;
            var validoSenha = false;

            var resposta; //Node

     function carregar() {
      var xmlhttp = new XMLHttpRequest();
      var url = "http://localhost:3000/Usuario";

      xmlhttp.onreadystatechange=function()
      {
          if (this.readyState == 4 && this.status == 200){
              Verificar(this.responseText);
          }
      }

      xmlhttp.open("GET", url, true);
     
      xmlhttp.send();
     }

           function Verificar(res)
            {
              resposta= JSON.parse(res);

              for(var i =0; i < resposta.length; i++)
              {
                if(resposta[i].Nome + resposta[i].senha == document.getElementById("usuario").value + document.getElementById("senha").value)
                    window.open('Node.js/pp.html');
                else
                  alert("Os dados não existem! Deseja fazer um cadastro?");
              }      
                 
            }

            function Cadastro()
            {
               document.getElementsByTagName("body")[0].style.background = "white";
               document.getElementsByClassName("cadastro")[0].style.display = "block";
               document.getElementsByClassName("transparencia")[0].style.filter = "brightness(20%)";
               document.getElementById("password2").style.borderBottom = "0.4px solid darkgray";
               document.getElementById("password2").style.boxShadow = "0 0.4px 0 0 darkgray";

            }

             function Sumir()
            {
               document.getElementsByTagName("body")[0].style.background = "url(\"./Node.js/imagens/fundo.gif\");";
               document.getElementsByClassName("cadastro")[0].style.display = "none";
               document.getElementsByClassName("transparencia")[0].style.filter = " brightness(100%)";
              

            }
            
            function boolean Tool()
            {
                var senha1 = document.getElementById("password").value;
                var senha2 = document.getElementById("password2").value;

                if(senha2!="")
                {
                    if(senha1!=senha2  )
                    {
                        document.getElementsByClassName("tooltiptext")[0].style.display = "block";
                        document.getElementsByClassName("tooltiptext")[0].style. visibility = "visible";
                        document.getElementsByClassName("tooltiptext")[0].style.opacity = "1";
                        document.getElementById("password2").style.borderBottom = "1px solid red";
                        document.getElementById("password2").style.boxShadow = "0 1px 0 0 red";
                        document.getElementById("frase").style.color = "red";
                       validoSenha = false;
                    }
                    else
                    {
                       document.getElementsByClassName("tooltiptext")[0].style.display = "none";
                        document.getElementsByClassName("tooltiptext")[0].style. visibility = "hidden";
                        document.getElementsByClassName("tooltiptext")[0].style.opacity = "1";        
                         document.getElementById("password2").style.borderBottom = "1px solid #57A856";
                         document.getElementById("password2").style.boxShadow = "0 1px 0 0 #57A856";
                         document.getElementById("frase").style.color = "green";
                         validoSenha = true;
                    }
                  }

                  return validoSenha;
            }

             function TirarTool()
            {
             var senha1 = document.getElementById("password").value;
             var senha2 = document.getElementById("password2").value;
              
        
            document.getElementsByClassName("tooltiptext")[0].style.display = "none";
            document.getElementsByClassName("tooltiptext")[0].style. visibility = "hidden";
            document.getElementsByClassName("tooltiptext")[0].style.opacity = "1";
                   
                   
            }
            //?
            /*
           function Validar()
           {
              if(document.form1.checkValidity ())
                valido2 = true;
               
           }*/
            /*
            function Abrir()
            {
               //Parte Node
                nodeCadastro();


              
              Validar();
                if(valido && valido2)
                {
                   window.open('Node.js/pp.html');
                 } 
                 else 
                 {
                          if(!document.form1.user.validity.patternMismatch)
                          alert("user");
                        if(!document.form1.email.validity.patternMismatch)
                          alert("email");
                        if(!document.form1.senha.validity.patternMismatch)
                          alert("senha");
                        if(!document.form1.tel.validity.patternMismatch)
                          alert("tel");
                 }
            }*/
            
            function nodeCadastro()
            {
              for(var i =0; i < resposta.length; i++)
              {
                if(resposta[i].Nome = document.getElementById("username2").value)
                {
                  alert("Esse nome já foi cadastrado! Forneça um diferente para prosseguir.");      
                }
                if(resposta[i].email = document.getElementById("email").value)
                {
                  alert("Esse e-mail já foi cadastrado! Forneça um diferente para prosseguir.");
                }
                if(resposta[i].telefone = document.getElementById("tel").value)
                {
                  alert("Esse telefone já foi cadastrado! Forneça um diferente para prosseguir.");    
                }
    
                else  
                {                    
                  if(Tool)
                  {
                    valido = true;
                     window.open('Node.js/pp.html');
                  }
                  else
                   alert("Verifique se as senhas estão corretas");
                }
              }

            }

            //teste
            
                    </script>

    </head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="Login.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <body>
      
            <div class="transparencia">
    <header>
        <p class = "logo"></p>
        <center>
       <div class="titulo" ></div>
    </center>
        
                        <center>
                <div class="user"></div><br>
                <div class="frase">Ol&aacute;! Digite o seu usu&aacute;rio e senha</div>
                
        </center>
        
        <div class="contato">
            
        <a href="Contato.html" class="cont"> Contato </a>
        </div>
    </header>
    
            <div class="bloco">
                
                    <div class="peq">
                     <form class="col s12" name = "form2" onsubmit=" return false;">
              <div class="row">
                <div class="input-field col s12">
                  <i class="material-icons prefix">account_circle</i>
                  <input id="usuario" type="text" class="validate" required name="usu">
                  <label for="usuario"> Usu&aacute;rio</label>
                </div>
                </div>
                <div class="row">
                <div class="input-field col s12" id = "topSenha">
                    <i class="material-icons prefix">lock</i>
                  <input id="senha" type="password" class="validate" required  name="senhaa">
                  <label for="senha">Senha</label>
                </div>
              </div>                   
                    
                             <button  onclick="carregar()"class="css3button" id = "botao"> ENTRAR </button><br><br><br>
                             
                         <u><a onclick="Cadastro()" class="cad"> Ainda n&atilde;o tem cadastro?! </a></u>
                            </form> 
                    </div>
            </div>
                </div>
            <div class="cadastro">
              <div class="seta" onclick="Sumir()"></div>
                <div class="tit"></div>
                <br><br>
                <div class="dados">
                Preencha o formulário com seus dados pessoais
                </div>
                <div class="posicao">  
                <br><br>
                <div class="row">
            <form class="col s12" name = "form1" onsubmit=" return false;">
              <div class="row">
                <div class="input-field col s6">
                  <i class="material-icons prefix">account_circle</i>
                  <input id="username2" type="text" class="validate" required pattern=".{6,15}" title="De 6 a 10 caracteres" name="user">
                  <label for="username2">Username</label>
                </div>
                </div>
             <div class="row">
                <div class="input-field col s6">
                    <i class="material-icons prefix">email</i>
                  <input id="email" type="email" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" class="validate" required name="email">
                  <label for="email">Email</label>
                </div>
              </div>
                
                <div class="row">
                <div class="input-field col s6">
                    <i class="material-icons prefix">phone</i>
                  <input id="tel" type="tel" pattern="[\(]\d{2}[\)]\d{5}[\-]\d{4}" class="validate" required name="tel">
                  <label for="tel">Telefone((99) 99999-9999)</label>
                </div>
              </div>
                
            <div class="row">    
            <div class="input-field col s6">
                 <i class="material-icons prefix">insert_invitation</i>
                <input type="date" name="aniversario" class="datepicker" pattern="^\d{2}/\d{2}/\d{4}$" class="validate" required>
                <label for="aniversario">Data Nascimento</label>
            </div>
                </div>
                
              <div class="row">
                <div class="input-field col s16">
                    <i class="material-icons prefix">lock</i>
                  <input id="password" type="password" class="validate" required pattern=".{8,}" onblur="Tool()" name="senha">
                  <label for="password">Senha</label>
                </div>
              </div>
                  <div class="row">
                <div class="input-field col s16">
                  <div class="tooltip">
                    <i class="material-icons prefix">lock</i>
                  <input id="password2" type="password" onblur="Tool()" class="validate" onfocus="TirarTool()" required>
                  
                  <label for="password2" id="frase">Confirmar senha</label>
                  <span class="tooltiptext">As senhas não batem.</span>
                </div>
                </div>
              </div>
              <button class="txtSubmit" id = "botao" onclick="nodeCadastro()">Cadastrar</button><br><br><br>
               
            </form>
           
          </div>
                              
                    </div>
                    
            </div>
           
    </body>
</html>

                